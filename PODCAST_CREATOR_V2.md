# Podcast Creator V2 - Unified Source Selection Architecture

## Overview

We've completely overhauled the podcast creator with a modern, scalable split-pane interface that supports unified multi-source search and selection.

## Architecture

### Frontend Structure

```
src/components/podcast/
â”œâ”€â”€ PodcastCreator.tsx         (Main container with split layout)
â”œâ”€â”€ PodcastCreator.css         (Split-pane responsive layout)
â”œâ”€â”€ SourcesPanel.tsx           (Left pane: search + source selection)
â”œâ”€â”€ SourcesPanel.css           (Source cards, search UI)
â”œâ”€â”€ ScriptPanel.tsx            (Right pane: config + generation)
â””â”€â”€ ScriptPanel.css            (Episode config, audio player)

src/contexts/
â””â”€â”€ PodcastCreationContext.tsx (Global state management)

src/types/
â””â”€â”€ podcast.ts                  (TypeScript interfaces)
```

### Backend Changes

**File**: `backend/routers/search.py`

**New Endpoint**: `POST /search/unified`

```python
{
  "query": "transformer architectures",
  "providers": ["papers", "semantic_scholar"],
  "limit": 10
}
```

**Response**:
```json
{
  "success": true,
  "sources": [
    {
      "id": "paper-uuid",
      "type": "paper",
      "source": "database",
      "title": "Attention Is All You Need",
      "authors": "Vaswani et al.",
      "year": 2017,
      "abstract": "...",
      "url": "https://...",
      "citation_count": 50000,
      "venue": "NeurIPS"
    },
    {
      "id": "ss-arxiv-id",
      "type": "paper",
      "source": "semantic_scholar",
      ...
    }
  ],
  "count": 10
}
```

### Key Features

#### 1. **Split-Pane Layout** (40% / 60%)
- **Left Pane**: Source search and selection
- **Right Pane**: Episode configuration and generation
- Responsive: stacks vertically on smaller screens

#### 2. **Unified Search**
- Single search bar
- Multi-provider checkboxes:
  - âœ… Database Papers (implemented)
  - âœ… Semantic Scholar (implemented)
  - ðŸš§ Perplexity (coming soon)
  - ðŸš§ YouTube (coming soon)
- Parallel search execution
- Normalized result format

#### 3. **Source Accumulation**
- Search results shown in left pane
- Click **[+ Add]** to accumulate sources
- Selected sources persist during session
- **[Ã— Remove]** to remove from selection
- Real-time count display

#### 4. **Episode Configuration**
- **Theme** (required): Main topic/angle
- **Title** (optional): Auto-generated by AI if empty
- **Description** (optional): Auto-generated by AI if empty

#### 5. **Generation Flow**
```
Select Sources â†’ Configure Theme â†’ Generate Podcast
     â†“                   â†“                  â†“
 Search UI         Config Form       API Call to /podcast/generate
     â†“                   â†“                  â†“
 Add to Cart      Set metadata      Script + Audio generation
     â†“                   â†“                  â†“
Multiple sources  Optional custom    AI-generated title if not provided
   in left pane   title/description         â†“
                                      Audio player in right pane
```

#### 6. **Audio Playback**
- In-browser HTML5 audio player
- Download MP3 button
- Link to view all episodes

## State Management

**Context**: `PodcastCreationContext`

```typescript
interface PodcastCreationState {
  // Search
  searchQuery: string
  searchProviders: { papers, semantic_scholar, perplexity, youtube }
  searchResults: UnifiedSource[]
  isSearching: boolean

  // Selection
  selectedSources: UnifiedSource[]

  // Config
  config: { theme, title, description }

  // Generation
  script: string | null
  isGeneratingScript: boolean
  audioUrl: string | null
  isGeneratingAudio: boolean
  episodeId: string | null
}
```

**Actions**:
- `setSearchQuery(query)`
- `toggleProvider(provider)`
- `search()` - async
- `addSource(source)`
- `removeSource(sourceId)`
- `updateConfig(updates)`
- `generatePodcast()` - async
- `reset()`

## Backend Implementation

### Parallel Search

```python
async def unified_search(request: UnifiedSearchRequest):
    tasks = []

    if "papers" in request.providers:
        tasks.append(_search_database_papers(...))

    if "semantic_scholar" in request.providers:
        tasks.append(_search_semantic_scholar_unified(...))

    # Execute in parallel
    results = await asyncio.gather(*tasks, return_exceptions=True)

    # Normalize and combine
    return {"success": True, "sources": combined_results}
```

### Database Search

Searches papers table with ILIKE across:
- title
- authors
- abstract
- venue

### Semantic Scholar Search

- Uses `/graph/v1/paper/search` API
- Includes retry logic for rate limiting
- Returns papers with citation counts

## UI/UX Design

### Color Scheme
- **Primary**: `#4299e1` (Blue)
- **Success**: `#48bb78` (Green)
- **Danger**: `#e53e3e` (Red)
- **Database Badge**: `#48bb78` (Green)
- **Semantic Scholar Badge**: `#4299e1` (Blue)
- **Background**: `#f5f7fa` (Light gray)

### Layout Patterns
- **Source Cards**: Hover effect with border color change
- **Selected Sources**: Blue background (`#e7f3ff`)
- **Generate Button**: Gradient purple background
- **Audio Section**: Centered with prominent controls

### Responsive Design
- **Desktop** (>1200px): Side-by-side panes
- **Tablet/Mobile** (<1200px): Stacked layout
- Sources pane: Max 600px height when stacked
- Script pane: Min 600px height

## Integration Points

### Existing Backend Endpoints Used

1. **POST /search/unified** (new)
   - Multi-provider search

2. **POST /podcast/generate** (existing)
   - Accepts `paper_ids`, `theme`, optional `title`/`description`
   - Returns `episode_id`, `audio_url`

### Existing Components Updated

- **App.tsx**: Import path updated to `components/podcast/PodcastCreator`
- **PodcastManager.tsx**: Link to `/admin/podcast-creator` already in place

## Future Enhancements

### Phase 2: YouTube Integration
- Add `lib/sources/youtube_service.py`
- Use yt-dlp for video search
- Extract transcripts with YouTube captions API
- Store in unified sources format

### Phase 3: Perplexity Integration
- Add `lib/sources/perplexity_service.py`
- Use perplexipy (already installed)
- Research query â†’ synthesized article
- Store as "research" type source

### Phase 4: Interactive Co-host Recording
- Real-time voice interaction with Gemini
- Segment-based recording
- Audio cleanup/editing post-recording
- Will require new recording panel in ScriptPanel

### Phase 5: Source Database
- Create `sources` table in Supabase
- Store all sources with unified schema
- Create `episode_sources` junction table
- Enable source reuse across episodes

## Testing Checklist

- [ ] Search database papers
- [ ] Search Semantic Scholar
- [ ] Add sources to selection
- [ ] Remove sources from selection
- [ ] Generate podcast with 1 source
- [ ] Generate podcast with multiple sources
- [ ] Auto-generate title (leave blank)
- [ ] Auto-generate description (leave blank)
- [ ] Custom title and description
- [ ] Audio playback
- [ ] Download MP3
- [ ] Responsive layout (mobile/tablet)
- [ ] Error handling (no sources, no theme, API errors)

## Files Changed

### New Files
- `src/components/podcast/PodcastCreator.tsx` (38 lines)
- `src/components/podcast/PodcastCreator.css` (64 lines)
- `src/components/podcast/SourcesPanel.tsx` (176 lines)
- `src/components/podcast/SourcesPanel.css` (213 lines)
- `src/components/podcast/ScriptPanel.tsx` (131 lines)
- `src/components/podcast/ScriptPanel.css` (189 lines)
- `src/contexts/PodcastCreationContext.tsx` (252 lines)
- `src/types/podcast.ts` (46 lines)

### Modified Files
- `backend/routers/search.py` (+132 lines)
  - Added UnifiedSearchRequest model
  - Added UnifiedSource model
  - Added `/unified` endpoint
  - Added helper functions for parallel search
- `src/App.tsx` (1 line changed)
  - Updated import path

### Total
- **New code**: ~1,241 lines
- **Modified code**: ~133 lines
- **Total changes**: ~1,374 lines

## Benefits Over Old Approach

1. **Scalable**: Easy to add new search providers
2. **Unified UX**: Single search interface vs separate sections
3. **Real-time**: Sources accumulate as you search
4. **Flexible**: Mix-and-match from different providers
5. **Clean Architecture**: Clear separation of concerns
6. **Type-Safe**: Full TypeScript coverage
7. **Maintainable**: Context-based state vs prop drilling
8. **Modern**: Split-pane layout borrowed from research tools

## Lessons from Open Source

**From open-notebook**:
- Three-column layout concept (we use 2)
- Sources as first-class citizens
- Clean, research-focused UI

**From tldw_server**:
- Unified media ingestion pattern
- Provider checkboxes
- Parallel search architecture

**Our innovations**:
- Podcast-specific workflow
- Real-time accumulation
- Theme-first episode creation
- Gradient generate button ðŸ˜Ž
